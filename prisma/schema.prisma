generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum BetStatus {
  PENDING
  WON
  LOST
}

enum Color {
  RED
  GREEN
  BLUE
  YELLOW
}

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
}

enum TransactionStatus {
  PENDING
  CONFIRMED
  FAILED
}

enum WithdrawalStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}

model User {
  id                 Int                 @id @default(autoincrement())
  name               String              @db.VarChar(100)
  email              String              @unique @db.VarChar(150)
  phone              String?             @unique @db.VarChar(20)
  passwordHash       String              @map("password_hash") @db.VarChar(255)
  isAdmin            Boolean             @default(false) @map("is_admin")
  balance            Decimal             @default(0) @db.Decimal(12, 2)
  createdAt          DateTime            @default(now()) @map("created_at")
  bets               Bet[]
  cryptoAddresses    CryptoAddress[]
  cryptoTransactions CryptoTransaction[]
  withdrawals        WithdrawalRequest[]

  @@map("users")
}

model GameType {
  id    Int    @id @default(autoincrement())
  code  String @unique @db.VarChar(50)
  name  String @db.VarChar(100)
  draws Draw[]
  bets  Bet[]

  @@map("game_types")
}

model Draw {
  id            Int       @id @default(autoincrement())
  drawCode      String?   @unique @map("draw_code") @db.VarChar(20)
  gameTypeId    Int       @map("game_type_id")
  drawTime      DateTime  @map("draw_time")
  winningNumber Int?      @map("winning_number")
  winningColor  Color?    @map("winning_color")
  isClosed      Boolean   @default(false) @map("is_closed")
  createdAt     DateTime  @default(now()) @map("created_at")
  gameType      GameType  @relation(fields: [gameTypeId], references: [id])
  bets          Bet[]

  @@index([gameTypeId])
  @@index([isClosed, drawTime])
  @@map("draws")
}

model Bet {
  id           Int       @id @default(autoincrement())
  userId       Int       @map("user_id")
  drawId       Int       @map("draw_id")
  amount       Decimal   @db.Decimal(12, 2)
  chosenNumber Int?      @map("chosen_number")
  chosenColor  Color?    @map("chosen_color")
  status       BetStatus @default(PENDING)
  payout       Decimal   @default(0) @db.Decimal(12, 2)
  placedAt     DateTime  @default(now()) @map("placed_at")
  gameTypeId   Int?      @map("game_type_id")
  user         User      @relation(fields: [userId], references: [id])
  draw         Draw      @relation(fields: [drawId], references: [id])
  gameType     GameType? @relation(fields: [gameTypeId], references: [id])

  @@index([userId])
  @@index([drawId])
  @@index([gameTypeId])
  @@index([userId, drawId])
  @@map("bets")
}

model CryptoAddress {
  id              Int       @id @default(autoincrement())
  userId          Int       @map("user_id")
  walletAddress   String    @unique @map("wallet_address") @db.VarChar(128)
  amount          Decimal   @db.Decimal(18, 6)
  privateKeyPlain String?   @map("private_key_plain") @db.VarChar(255)
  isUsed          Boolean   @default(false) @map("is_used")
  createdAt       DateTime  @default(now()) @map("created_at")
  usedAt          DateTime? @map("used_at")
  user            User      @relation(fields: [userId], references: [id])

  @@index([userId, isUsed])
  @@map("crypto_addresses")
}

model CryptoTransaction {
  id        Int               @id @default(autoincrement())
  userId    Int               @map("user_id")
  address   String            @db.VarChar(128)
  amount    Decimal           @db.Decimal(18, 6)
  type      TransactionType
  status    TransactionStatus
  createdAt DateTime          @default(now()) @map("created_at")
  user      User              @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
  @@map("crypto_transactions")
}

model WithdrawalRequest {
  id            Int              @id @default(autoincrement())
  userId        Int              @map("user_id")
  amount        Decimal          @db.Decimal(18, 6)
  walletAddress String           @map("wallet_address") @db.VarChar(128)
  status        WithdrawalStatus @default(PENDING)
  createdAt     DateTime         @default(now()) @map("created_at")
  user          User             @relation(fields: [userId], references: [id])

  @@index([userId, status])
  @@map("withdrawal_requests")
}